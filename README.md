# RM-PP03

STRV's Studio RM-PP03用ファームウェア

# 開発環境

- STM32CubeMX
  - 6.9.2 or Higher
- STM32Cube MCU Package for STM32F0 Series
  - 1.6.1

## 動作確認環境

- STM32CubeCLT
- VSCode
  - STM32 VS Code Extension

# ビルド手順

1. STM32CubeMX で ioc ファイルを開く
1. GENERATE CODE でコード生成する
1. 各自環境でコンパイル

# Modbus設定

## プロトコル詳細
- Modbus RTU
  - ボーレート 115200
  - パリティなし
  - スタートビット 1
  - ストップビット 1
  - データビット 8

※ASCIIには非対応

## コイル

アドレス | 割り当て | 内容
----- | ----- | -----
1 | 出力切り替え | 1:有効 / 0:無効
2 | 非常停止モード | 1:有効 / 0:無効

## 入力

アドレス | 割り当て | 内容
----- | ----- | -----
1 | 非常停止スイッチ状態 | 1:押下 / 0:無操作
2 | モードスイッチ状態 | 1 / 0

## 保持レジスタ

アドレス | 割り当て | 内容
----- | ----- | -----
1 | 平均電源電圧 | uint16電圧[mV]
2 | ピーク電源電圧 | uint16電圧[mV]
3 | 平均出力電流 | uint16電流[mA]
4 | ピーク出力電流 | uint16電流[mA]

## 入力レジスタ

アドレス | 割り当て | 内容
----- | ----- | -----
1 | 出力割合 | int16 (正：前進／負：後進)
2 | 常点灯出力割合 | uint16
3 | 低周波重畳割合 | uint16

# 使い方

## Modbus設定の流れ

1. 平均電源電圧を読み、電源が供給されていることを確認する
1. 非常停止を解除する
1. 出力を有効にする
1. 出力割合を上げて走行させる

## 常点灯の調整方法

1. 出力を有効にする
1. 出力割合を0にする
1. 常点灯を車両が走行するまで上げる
1. 常点灯を車両が停止するまで下げる

この調整を行うことで、車両が走り始めないギリギリの値で常点灯することができる。稀に走行抵抗の影響などにより、以降の走行時に出力割合を0にしても車両が止まらない場合がでるため、4の下げ幅は余裕を持つと良い。

# 今後の予定

- 電流制限機能
